# Tabby é¡¹ç›®å¼€å‘ç¯å¢ƒ

[![License](https://img.shields.io/badge/License-Apache_2.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)
[![Rust](https://github.com/TabbyML/tabby/actions/workflows/rust.yml/badge.svg)](https://github.com/TabbyML/tabby/actions/workflows/rust.yml)

è¿™æ˜¯ä¸€ä¸ª Tabby AI ä»£ç è¡¥å…¨å·¥å…·çš„å¼€å‘é¡¹ç›®ã€‚

## é¡¹ç›®ç®€ä»‹

Tabby æ˜¯ä¸€ä¸ªå¼€æºçš„ AI ä»£ç è¡¥å…¨å·¥å…·ï¼Œæ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€çš„æ™ºèƒ½ä»£ç æç¤ºå’Œè¡¥å…¨åŠŸèƒ½ã€‚

## æŠ€æœ¯æ ˆ

- **åç«¯**: Rust + Cargo (ä¸»è¦æ¡†æ¶)
- **å‰ç«¯**: Node.js + TypeScript + pnpm
- **æ„å»ºå·¥å…·**: Turbo (monorepo ç®¡ç†)
- **æœç´¢å¼•æ“**: Tantivy (å…¨æ–‡æœç´¢)
- **Web æ¡†æ¶**: Axum (å¼‚æ­¥ Web æ¡†æ¶)

## å¼€å‘ç¯å¢ƒé…ç½®

### ç³»ç»Ÿè¦æ±‚

- Node.js >= 18
- pnpm >= 9
- Rust æœ€æ–°ç¨³å®šç‰ˆ
- Git

### å®‰è£…ä¾èµ–

```bash
# å®‰è£… Node.js ä¾èµ–
pnpm install

# æ„å»ºé¡¹ç›®
pnpm run build

# è¿è¡Œæµ‹è¯•
pnpm test
```

### å¸¸ç”¨å‘½ä»¤

```bash
# æ„å»ºæ‰€æœ‰åŒ…
pnpm run build

# å¼€å‘æ¨¡å¼æ„å»º (Rust)
make dev-build

# å¼€å‘æ¨¡å¼ (VSCode)
pnpm run vscode:dev

# ä»£ç æ£€æŸ¥
pnpm run lint

# ä¿®å¤ä»£ç æ ¼å¼
pnpm run lint:fix
```

## æ•…éšœæ’é™¤ ğŸ”§

### ç¼–è¯‘é—®é¢˜è§£å†³è®°å½•

å¦‚æœé‡åˆ° `make dev-build` ç¼–è¯‘å¤±è´¥ï¼Œä»¥ä¸‹æ˜¯å¸¸è§é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆï¼š

#### 1. IndexingProgress Clone é—®é¢˜
**é”™è¯¯**: `IndexingProgress` ç»“æ„ä½“ç¼ºå°‘ `Clone` trait
**è§£å†³**: åœ¨ `IndexingProgress` ç»“æ„ä½“ä¸Šæ·»åŠ  `#[derive(Clone)]`

#### 2. CodeIndexer ç¼ºå°‘æ–¹æ³•
**é”™è¯¯**: `CodeIndexer` ç¼ºå°‘ `set_progress_callback` æ–¹æ³•
**è§£å†³**: åœ¨ `CodeIndexer` ä¸­æ·»åŠ  `progress_callback` å­—æ®µå’Œå¯¹åº”çš„ setter æ–¹æ³•

#### 3. å¯¼å…¥é”™è¯¯
**é”™è¯¯**: å„ç§æ¨¡å—å¯¼å…¥é—®é¢˜
**è§£å†³**:
- ä¿®æ­£ `tabby_inference::embedding` ä¸º `crate::services::embedding`
- ä¿®æ­£ tantivy ç›¸å…³å¯¼å…¥ï¼Œç¡®ä¿å¯¼å…¥æ­£ç¡®çš„ç±»å‹

#### 4. TantivyDocument ç±»å‹é—®é¢˜
**é”™è¯¯**: `TantivyDocument` æ˜¯ç»“æ„ä½“ä¸æ˜¯ trait
**è§£å†³**:
- å°†å‡½æ•°å‚æ•°ä» `impl TantivyDocument` æ”¹ä¸º `TantivyDocument`
- å¯¼å…¥ `tantivy::Document` trait ä»¥ä½¿ç”¨ `to_json` æ–¹æ³•

#### ç¼–è¯‘çŠ¶æ€æ£€æŸ¥
```bash
# æ£€æŸ¥ç¼–è¯‘çŠ¶æ€
make dev-build

# æˆ–è€…ç›´æ¥ä½¿ç”¨ cargo
cargo build --bin tabby
```

### å½“å‰ç¼–è¯‘çŠ¶æ€ âœ…
- **çŠ¶æ€**: âœ… ç¼–è¯‘æˆåŠŸ
- **è­¦å‘Š**: å­˜åœ¨ä¸€äº›æœªä½¿ç”¨çš„å­—æ®µå’Œå˜é‡è­¦å‘Šï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
- **æœ€åæ›´æ–°**: 2024-12-19

## Shell ç¯å¢ƒé…ç½® âœ…

### Oh My Zsh å®‰è£…å’Œé…ç½® (å·²å®Œæˆ)

âœ… **å·²æˆåŠŸå®‰è£…å’Œé…ç½® Oh My Zsh**

- **å®‰è£…çŠ¶æ€**: âœ… å·²å®‰è£… zsh 5.9-4
- **Oh My Zsh**: âœ… å·²å®‰è£…æœ€æ–°ç‰ˆæœ¬
- **é»˜è®¤ Shell**: âœ… å·²è®¾ç½® zsh ä¸ºé»˜è®¤ shell
- **é…ç½®æ–‡ä»¶**: `~/.zshrc` å·²é…ç½®
- **å½“å‰çŠ¶æ€**: âœ… zsh å’Œ Oh My Zsh æ­£åœ¨è¿è¡Œ

#### å¿«é€Ÿå¯åŠ¨

å¦‚æœåœ¨æ–°çš„ç»ˆç«¯ä¼šè¯ä¸­éœ€è¦å¯åŠ¨ zshï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š

1. **ç›´æ¥å¯åŠ¨**: è¿è¡Œ `zsh` æˆ– `exec zsh`
2. **ä½¿ç”¨è„šæœ¬**: è¿è¡Œ `./start_zsh.sh` (é¡¹ç›®æ ¹ç›®å½•ä¸‹å·²åˆ›å»º)
3. **æ–°ç»ˆç«¯**: æ–°æ‰“å¼€çš„ç»ˆç«¯åº”è¯¥è‡ªåŠ¨ä½¿ç”¨ zsh

#### å·²é…ç½®çš„åˆ«å

**æ–‡ä»¶æ“ä½œåˆ«å:**
- `ll` = `ls -la` (è¯¦ç»†åˆ—è¡¨æ˜¾ç¤ºï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶) âœ…
- `la` = `ls -la` (æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶è¯¦æƒ…)
- `l` = `ls -l` (æ˜¾ç¤ºæ–‡ä»¶è¯¦æƒ…)

**Git æ“ä½œåˆ«å:**
- `gcmt` = `git commit -m` (å¿«é€Ÿæäº¤) âœ…
- `gst` = `git status` (Git çŠ¶æ€)
- `glog` = `git log --oneline` (ç®€æ´çš„ Git æ—¥å¿—)
- `gpl` = `git pull` (Git æ‹‰å–)
- `gps` = `git push` (Git æ¨é€)
- `gco` = `git checkout` (Git åˆ‡æ¢åˆ†æ”¯)
- `gcb` = `git checkout -b` (åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯)

**é¡¹ç›®ç›¸å…³åˆ«å:**
- `build` = `pnpm run build` (æ„å»ºé¡¹ç›®)
- `test` = `pnpm test` (è¿è¡Œæµ‹è¯•)
- `dev` = `pnpm run vscode:dev` (VSCode å¼€å‘æ¨¡å¼)
- `lint` = `pnpm run lint` (ä»£ç æ£€æŸ¥)
- `lintfix` = `pnpm run lint:fix` (ä¿®å¤ä»£ç æ ¼å¼)

**Rust ç›¸å…³åˆ«å:**
- `ccheck` = `cargo check` (Rust ä»£ç æ£€æŸ¥)
- `cbuild` = `cargo build` (Rust æ„å»º)
- `ctest` = `cargo test` (Rust æµ‹è¯•)
- `crun` = `cargo run` (Rust è¿è¡Œ)

**ç³»ç»Ÿæ“ä½œåˆ«å:**
- `..` = `cd ..` (è¿”å›ä¸Šçº§ç›®å½•)
- `...` = `cd ../..` (è¿”å›ä¸Šä¸Šçº§ç›®å½•)
- `cls` = `clear` (æ¸…å±)
- `h` = `history` (å†å²å‘½ä»¤)

#### ä½¿ç”¨è¯´æ˜

1. **å¯åŠ¨ zsh**: æ‰“å¼€æ–°çš„ç»ˆç«¯çª—å£ä¼šè‡ªåŠ¨ä½¿ç”¨ zsh
2. **æŸ¥çœ‹æ‰€æœ‰åˆ«å**: è¿è¡Œ `alias` å‘½ä»¤
3. **ç¤ºä¾‹ç”¨æ³•**:
   ```bash
   ll                    # æŸ¥çœ‹å½“å‰ç›®å½•è¯¦ç»†ä¿¡æ¯
   gcmt "æ·»åŠ æ–°åŠŸèƒ½"      # å¿«é€Ÿ Git æäº¤
   build                 # æ„å»ºé¡¹ç›®
   dev                   # å¯åŠ¨å¼€å‘æ¨¡å¼
   ```

### ç¯å¢ƒé—®é¢˜æ’æŸ¥

å¦‚æœé‡åˆ°ç¯å¢ƒé—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. Node.js ç‰ˆæœ¬æ˜¯å¦ >= 18
2. pnpm ç‰ˆæœ¬æ˜¯å¦ >= 9
3. Rust å·¥å…·é“¾æ˜¯å¦æ­£ç¡®å®‰è£…
4. Git é…ç½®æ˜¯å¦æ­£ç¡®
5. **Shell ç¯å¢ƒ**: ç¡®è®¤å½“å‰ä½¿ç”¨çš„æ˜¯ zsh (`echo $SHELL`)

## é¡¹ç›®ç»“æ„

- `crates/` - Rust æ ¸å¿ƒä»£ç 
  - `tabby/` - ä¸»è¦çš„ Tabby åº”ç”¨ç¨‹åº
  - `tabby-index/` - ç´¢å¼•ç›¸å…³åŠŸèƒ½
  - `tabby-inference/` - AI æ¨ç†åŠŸèƒ½
  - `tabby-common/` - é€šç”¨å·¥å…·å’Œé…ç½®
- `ee/` - ä¼ä¸šç‰ˆåŠŸèƒ½
- `clients/` - å®¢æˆ·ç«¯ä»£ç 
- `docs/` - æ–‡æ¡£
- `website/` - å®˜ç½‘ä»£ç 

## æ ¸å¿ƒåŠŸèƒ½

### ç´¢å¼•ç®¡ç† API
- **è·å–ç´¢å¼•ä¿¡æ¯**: `GET /v1/index/info`
  - è¿”å›ç´¢å¼•åˆ†ç‰‡æ•°é‡å’Œå ç”¨ç©ºé—´ä¿¡æ¯
- **è·å–æ–‡æ¡£åˆ—è¡¨**: `GET /v1/index/documents/{corpus}`
  - è·å–æŒ‡å®šè¯­æ–™åº“çš„æ–‡æ¡£åˆ—è¡¨ï¼Œé™åˆ¶è¿”å›å‰10ä¸ªæ–‡æ¡£
- **åˆ›å»ºç´¢å¼•**: `POST /v1/index/create` (SSE æµå¼å“åº”)
  - æ”¯æŒGitä»“åº“å’Œè¿œç¨‹ZIPæ–‡ä»¶ä½œä¸ºæº
  - å®æ—¶è¿›åº¦æ¨é€ï¼ŒåŒ…å«è¯¦ç»†çš„çŠ¶æ€ä¿¡æ¯ï¼š
    - `status`: å¤„ç†çŠ¶æ€ (initializing, downloading, extracting, cloning, indexing, completed, failed)
    - `status_msg`: å…·ä½“çš„çŠ¶æ€æ¶ˆæ¯ï¼Œæè¿°å½“å‰æ­£åœ¨è¿›è¡Œçš„æ“ä½œ
    - `progress_percentage`: è¿›åº¦ç™¾åˆ†æ¯” (0-100)
    - `current_phase`: å½“å‰é˜¶æ®µ (initializing, downloading, extracting, cloning, indexing)
    - `index_stats`: ç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ (ç›®å½•æ•°é‡ã€è·³è¿‡æ–‡ä»¶æ•°ã€ä»£ç è¡Œæ•°ã€ä»£ç å—æ•°ç­‰)
    - `processing_rate`: å¤„ç†é€Ÿåº¦ (æ–‡ä»¶/ç§’)
    - `estimated_completion`: é¢„ä¼°å®Œæˆæ—¶é—´
  - ç«‹å³å“åº”æœºåˆ¶ï¼šæ¥æ”¶è¯·æ±‚åç«‹å³å‘é€åˆå§‹çŠ¶æ€ï¼Œé¿å…ç”¨æˆ·ç­‰å¾…
  - è¯¦ç»†è¿›åº¦åˆ†é˜¶æ®µï¼š
    - åˆå§‹åŒ–é˜¶æ®µ (0-5%)
    - ä¸‹è½½/å…‹éš†é˜¶æ®µ (5-30%)
    - ç´¢å¼•å¤„ç†é˜¶æ®µ (30-100%)

#### åˆ›å»ºç´¢å¼•è¯·æ±‚å‚æ•°ï¼š
```json
{
  "source": "https://github.com/user/repo.git",
  "is_remote_zip": false,
  "name": "my-index",
  "language": "rust",
  "max_file_size": 1024,
  "exclude": ["*.md", "tests/*"],
  "include": ["src/**", "lib/**"]
}
```

#### SSEå“åº”ç¤ºä¾‹ï¼š
```json
{
  "total_files": 150,
  "processed_files": 75,
  "updated_chunks": 340,
  "progress_percentage": 50.0,
  "status": "æ­£åœ¨ç´¢å¼•æ–‡ä»¶... (75/150)",
  "current_file": null,
  "start_time": "2024-03-21T10:30:00Z",
  "estimated_completion": "2024-03-21T10:32:30Z",
  "processing_rate": 12.5
}
```

### ä¸»è¦ç‰¹æ€§
- ğŸ” **æ™ºèƒ½ä»£ç æœç´¢**: åŸºäº Tantivy çš„å…¨æ–‡æœç´¢
- ğŸ¤– **AI ä»£ç è¡¥å…¨**: æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€
- ğŸ“Š **å®æ—¶ç´¢å¼•**: æ”¯æŒå¢é‡ç´¢å¼•å’Œå®æ—¶æ›´æ–°
- ğŸŒ **Web API**: RESTful API æ¥å£
- ğŸ“ **å¤šæºæ”¯æŒ**: æ”¯æŒ Git ä»“åº“å’Œè¿œç¨‹ ZIP æ–‡ä»¶

## è´¡çŒ®æŒ‡å—

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»º Pull Request

## æœ€è¿‘æ›´æ–°

- âœ… 2024-12-19: **åˆ›å»ºèŠå¤©æœåŠ¡ç®¡ç†è„šæœ¬å¥—ä»¶** - ä¸ºQwen2èŠå¤©æœåŠ¡åˆ›å»ºäº†å®Œæ•´çš„ç®¡ç†å·¥å…·
  - æ–°å¢ `start_chat_service.sh` - æ™ºèƒ½å¯åŠ¨è„šæœ¬ï¼Œæ”¯æŒå‚æ•°è‡ªå®šä¹‰ã€ç«¯å£æ£€æŸ¥ã€è¿›ç¨‹ç®¡ç†
  - æ–°å¢ `stop_chat_service.sh` - ä¼˜é›…åœæ­¢è„šæœ¬ï¼Œæ”¯æŒå¼ºåˆ¶ç»ˆæ­¢ã€æ¸…ç†åŠŸèƒ½
  - æ–°å¢ `status_chat_service.sh` - çŠ¶æ€ç›‘æ§è„šæœ¬ï¼Œæ˜¾ç¤ºè¿›ç¨‹ã€ç«¯å£ã€æ—¥å¿—ä¿¡æ¯
  - æ–°å¢ `test_chat_service.sh` - è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼ŒåŒ…å«è¿é€šæ€§ã€APIã€æ€§èƒ½æµ‹è¯•
  - æ‰€æœ‰è„šæœ¬éƒ½æ”¯æŒä¸­æ–‡ç•Œé¢ã€å½©è‰²è¾“å‡ºã€è¯¦ç»†å¸®åŠ©ä¿¡æ¯
  - å®Œæ•´çš„æ—¥å¿—è®°å½•å’Œé”™è¯¯å¤„ç†æœºåˆ¶
- âœ… 2024-12-19: **å®Œå–„åˆ›å»ºç´¢å¼•æ¥å£SSEå“åº”** - æ·»åŠ è¯¦ç»†çš„è¿›åº¦å›è°ƒåŠŸèƒ½ï¼Œç°åœ¨SSEå“åº”ä¸­çš„å…³é”®å­—æ®µéƒ½æœ‰å®é™…å€¼
  - æ–°å¢ `CodeIndexer::set_progress_callback` æ–¹æ³•æ”¯æŒè¿›åº¦å›è°ƒ
  - æ–°å¢ `index_repository_with_progress` å‡½æ•°ï¼Œæä¾›å®æ—¶è¿›åº¦ä¿¡æ¯
  - å®Œå–„ `IndexingProgress` ç»“æ„ä½“ï¼ŒåŒ…å«9ä¸ªè¯¦ç»†å­—æ®µï¼šæ–‡ä»¶ç»Ÿè®¡ã€è¿›åº¦ç™¾åˆ†æ¯”ã€çŠ¶æ€æè¿°ã€æ—¶é—´ä¿¡æ¯ã€å¤„ç†é€Ÿåº¦ç­‰
  - SSEå“åº”ç°åœ¨åŒ…å«å®æ—¶çš„æ–‡ä»¶å¤„ç†è¿›åº¦ã€é¢„ä¼°å®Œæˆæ—¶é—´ã€å¤„ç†é€Ÿåº¦ç­‰æœ‰ç”¨ä¿¡æ¯
- âœ… 2024-12-19: è§£å†³æ‰€æœ‰ç¼–è¯‘é—®é¢˜ï¼Œ`make dev-build` ç°åœ¨å¯ä»¥æ­£å¸¸å·¥ä½œ
- âœ… 2024-12-19: ä¿®å¤ TantivyDocument ç±»å‹é—®é¢˜å’Œ Document trait å¯¼å…¥
- âœ… 2024-12-19: ä¿®å¤ IndexingProgress Clone é—®é¢˜å’Œ CodeIndexer æ–¹æ³•ç¼ºå¤±
- âœ… 2024-12-19: æ·»åŠ æ•…éšœæ’é™¤æ–‡æ¡£å’Œç¼–è¯‘é—®é¢˜è§£å†³è®°å½•
- âœ… 2024-05-26: æˆåŠŸå®‰è£…å’Œé…ç½® Oh My Zsh
- âœ… 2024-05-26: é…ç½®å¸¸ç”¨åˆ«å (ll, gcmt ç­‰)
- âœ… 2024-05-26: è®¾ç½® zsh ä¸ºé»˜è®¤ shell
- âœ… 2024-12-19: **æ›´æ–°èŠå¤©æœåŠ¡å¯åŠ¨è„šæœ¬** - æ ¹æ®å®é™…å¯åŠ¨å‘½ä»¤ä¼˜åŒ–è„šæœ¬é…ç½®
  - æ›´æ–°å¯åŠ¨å‘½ä»¤æ ¼å¼: `RUST_LOG=debug ./target/debug/tabby serve --model StarCoder-1B --chat-model Qwen2-1.5B-Instruct --device cpu --port 8080`
  - æ–°å¢ `--model` å‚æ•°æ”¯æŒä»£ç è¡¥å…¨æ¨¡å‹é…ç½®
  - æ–°å¢ `--log-level` å‚æ•°æ”¯æŒæ—¥å¿—çº§åˆ«è°ƒæ•´
  - å®Œå–„å‚æ•°è¯´æ˜å’Œä½¿ç”¨ç¤ºä¾‹
  - åŒºåˆ†ä»£ç è¡¥å…¨æ¨¡å‹å’ŒèŠå¤©æ¨¡å‹çš„é…ç½®

## è®¸å¯è¯

è¯¦è§ LICENSE æ–‡ä»¶ã€‚

## èŠå¤©æœåŠ¡ç®¡ç†è„šæœ¬ ğŸ¤–

é¡¹ç›®æ ¹ç›®å½•ä¸‹æä¾›äº†ä¸€å¥—å®Œæ•´çš„èŠå¤©æœåŠ¡ç®¡ç†è„šæœ¬ï¼Œæ–¹ä¾¿è¿›è¡ŒæœåŠ¡è‡ªæµ‹ï¼š

### ğŸ“‹ è„šæœ¬åˆ—è¡¨

- **å¯åŠ¨æœåŠ¡**: `start_chat_service.sh` - å¯åŠ¨Qwen2èŠå¤©æœåŠ¡
- **åœæ­¢æœåŠ¡**: `stop_chat_service.sh` - åœæ­¢èŠå¤©æœåŠ¡
- **çŠ¶æ€æŸ¥çœ‹**: `status_chat_service.sh` - æŸ¥çœ‹æœåŠ¡è¿è¡ŒçŠ¶æ€
- **æœåŠ¡æµ‹è¯•**: `test_chat_service.sh` - æµ‹è¯•æœåŠ¡åŠŸèƒ½

### ğŸš€ å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®å¯åŠ¨ (StarCoder-1B + Qwen2-1.5B-Instruct, CPU, ç«¯å£8080)
./start_chat_service.sh

# è‡ªå®šä¹‰å‚æ•°å¯åŠ¨
./start_chat_service.sh -p 8081 -d gpu --model "CodeLlama-7B" -m "Qwen2-7B-Instruct"

# è°ƒæ•´æ—¥å¿—çº§åˆ«
./start_chat_service.sh --log-level trace

# æŸ¥çœ‹å¸®åŠ©
./start_chat_service.sh --help
```

**å¯åŠ¨å‚æ•°è¯´æ˜:**
- `--model`: æŒ‡å®šä»£ç è¡¥å…¨æ¨¡å‹ (é»˜è®¤: StarCoder-1B)
- `-m, --chat-model`: æŒ‡å®šèŠå¤©æ¨¡å‹ (é»˜è®¤: Qwen2-1.5B-Instruct)
- `-d, --device`: æŒ‡å®šè®¾å¤‡ (é»˜è®¤: cpuï¼Œå¯é€‰: gpu)
- `-p, --port`: æŒ‡å®šç«¯å£ (é»˜è®¤: 8080)
- `--log-level`: æŒ‡å®šæ—¥å¿—çº§åˆ« (é»˜è®¤: debugï¼Œå¯é€‰: trace, debug, info, warn, error)

**å®é™…æ‰§è¡Œçš„å‘½ä»¤æ ¼å¼:**
```bash
RUST_LOG=debug ./target/debug/tabby serve --model StarCoder-1B --chat-model Qwen2-1.5B-Instruct --device cpu --port 8080
```

### ğŸ›‘ åœæ­¢æœåŠ¡

```bash
# åœæ­¢é»˜è®¤ç«¯å£çš„æœåŠ¡
./stop_chat_service.sh

# åœæ­¢æŒ‡å®šç«¯å£çš„æœåŠ¡
./stop_chat_service.sh -p 8081

# åœæ­¢æœåŠ¡å¹¶æ¸…ç†ä¸´æ—¶æ–‡ä»¶
./stop_chat_service.sh --cleanup
```

### ğŸ“Š æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹å®Œæ•´æœåŠ¡çŠ¶æ€
./status_chat_service.sh

# åªæŸ¥çœ‹æœ€æ–°æ—¥å¿—
./status_chat_service.sh --logs

# æŸ¥çœ‹æŒ‡å®šç«¯å£çš„æœåŠ¡çŠ¶æ€
./status_chat_service.sh -p 8081
```

### ğŸ§ª æµ‹è¯•æœåŠ¡

```bash
# å®Œæ•´åŠŸèƒ½æµ‹è¯•
./test_chat_service.sh

# ä»…æµ‹è¯•è¿é€šæ€§
./test_chat_service.sh --connectivity-only

# ä»…æµ‹è¯•èŠå¤©API
./test_chat_service.sh --api-only

# ä»…æµ‹è¯•æ€§èƒ½
./test_chat_service.sh --performance-only

# æµ‹è¯•å…¶ä»–ç«¯å£
./test_chat_service.sh -p 8081
```

### ğŸ’¡ ä½¿ç”¨æµç¨‹ç¤ºä¾‹

```bash
# 1. å¯åŠ¨æœåŠ¡
./start_chat_service.sh

# 2. æŸ¥çœ‹çŠ¶æ€ (ç¡®è®¤æœåŠ¡æ­£å¸¸å¯åŠ¨)
./status_chat_service.sh

# 3. æµ‹è¯•æœåŠ¡ (éªŒè¯åŠŸèƒ½æ­£å¸¸)
./test_chat_service.sh

# 4. åœæ­¢æœåŠ¡ (æµ‹è¯•å®Œæˆå)
./stop_chat_service.sh
```

### ğŸ“ æ—¥å¿—å’Œæ–‡ä»¶

- **æ—¥å¿—ç›®å½•**: `./logs/`
- **æ—¥å¿—æ–‡ä»¶**: `./logs/chat_service_YYYYMMDD_HHMMSS.log`
- **PIDæ–‡ä»¶**: `./chat_service.pid`
- **è®¿é—®åœ°å€**: `http://localhost:8080` (é»˜è®¤)

### ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- **è‡ªåŠ¨ç«¯å£æ£€æŸ¥**: å¯åŠ¨å‰æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
- **è¿›ç¨‹ç®¡ç†**: è‡ªåŠ¨ç®¡ç†æœåŠ¡è¿›ç¨‹ï¼Œæ”¯æŒä¼˜é›…åœæ­¢
- **æ—¥å¿—è®°å½•**: è¯¦ç»†çš„æ—¥å¿—è®°å½•ï¼ŒæŒ‰æ—¶é—´æˆ³åˆ†æ–‡ä»¶
- **çŠ¶æ€ç›‘æ§**: å®æ—¶æŸ¥çœ‹æœåŠ¡çŠ¶æ€å’Œæ€§èƒ½ä¿¡æ¯
- **APIæµ‹è¯•**: è‡ªåŠ¨åŒ–çš„èŠå¤©APIåŠŸèƒ½æµ‹è¯•
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæç¤º
- **ä¸­æ–‡ç•Œé¢**: å‹å¥½çš„ä¸­æ–‡æ“ä½œç•Œé¢

### ğŸ”§ æ•…éšœæ’é™¤

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ’æŸ¥ï¼š

1. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**: `./status_chat_service.sh`
2. **æŸ¥çœ‹æ—¥å¿—**: `./status_chat_service.sh --logs`
3. **æµ‹è¯•è¿é€šæ€§**: `./test_chat_service.sh --connectivity-only`
4. **é‡å¯æœåŠ¡**: `./stop_chat_service.sh && ./start_chat_service.sh`

## æ ¸å¿ƒåŠŸèƒ½

## Code Indexing API ä¼˜åŒ–

### æ¦‚è¿°
æœ¬é¡¹ç›®å·²å®Œæˆå¯¹ Tabby çš„ code indexing èƒ½åŠ›çš„å…¨é¢ä¼˜åŒ–ï¼Œæ–°å¢äº†å¤šä¸ª API æ¨¡å—ï¼Œæä¾›äº†å®Œæ•´çš„ä»£ç ç´¢å¼•ç®¡ç†åŠŸèƒ½ã€‚

### æ–°å¢åŠŸèƒ½æ¨¡å—

#### 1. æœç´¢æ¨¡å— (Search Module)
- **ä»£ç å†…å®¹æœç´¢** (`POST /v1/index/search`)
  - æ”¯æŒå…¨æ–‡æœç´¢ä»£ç å†…å®¹
  - æ”¯æŒç¼–ç¨‹è¯­è¨€è¿‡æ»¤
  - æ”¯æŒæ–‡ä»¶è·¯å¾„è¿‡æ»¤
  - è¿”å›åŒ¹é…åˆ†æ•°å’Œè¯¦ç»†ä¿¡æ¯

- **æ–‡ä»¶è·¯å¾„æœç´¢** (`GET /v1/index/search/files`)
  - åŸºäºæ–‡ä»¶åçš„æ¨¡ç³Šæœç´¢
  - æ”¯æŒé™åˆ¶è¿”å›ç»“æœæ•°é‡

- **è¯­ä¹‰æœç´¢** (`POST /v1/index/search/semantic`)
  - åŸºäºè¯­ä¹‰çš„ä»£ç æœç´¢ï¼ˆé¢„ç•™æ¥å£ï¼‰
  - æ”¯æŒè‡ªç„¶è¯­è¨€æŸ¥è¯¢

#### 2. ç´¢å¼•ç®¡ç†æ¨¡å— (Index Management)
- **ç´¢å¼•çŠ¶æ€æŸ¥è¯¢** (`GET /v1/index/{indexId}/status`)
  - è·å–ç´¢å¼•çš„è¯¦ç»†çŠ¶æ€ä¿¡æ¯
  - åŒ…æ‹¬æ–‡æ¡£æ•°é‡ã€ç´¢å¼•å¤§å°ã€æœ€åæ›´æ–°æ—¶é—´ç­‰

- **ç´¢å¼•åˆ é™¤** (`DELETE /v1/index/{indexId}`)
  - å®‰å…¨åˆ é™¤æŒ‡å®šç´¢å¼•

- **ç´¢å¼•é‡å»º** (`POST /v1/index/{indexId}/rebuild`)
  - æ”¯æŒç´¢å¼•çš„å¢é‡é‡å»º
  - å®æ—¶è¿›åº¦åé¦ˆ

#### 3. é…ç½®ç®¡ç†æ¨¡å— (Configuration Management)
- **è·å–ç´¢å¼•é…ç½®** (`GET /v1/index/config`)
  - è¿”å›å½“å‰ç´¢å¼•é…ç½®ä¿¡æ¯
  - åŒ…æ‹¬æ–‡ä»¶å¤§å°é™åˆ¶ã€åŒ…å«/æ’é™¤æ¨¡å¼ç­‰

- **é…ç½®éªŒè¯** (`POST /v1/index/config/validate`)
  - éªŒè¯ç´¢å¼•é…ç½®çš„æœ‰æ•ˆæ€§
  - æä¾›é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯

#### 4. æ™ºèƒ½åˆ†ææ¨¡å— (Code Analysis)
- **ä»£ç åˆ†æ** (`POST /v1/index/analyze`)
  - åˆ†æä»£ç å¤æ‚åº¦
  - ç»Ÿè®¡å‡½æ•°å’Œç±»çš„æ•°é‡
  - è®¡ç®—ä»£ç è´¨é‡è¯„åˆ†
  - ç”Ÿæˆå»ºè®®çš„ç´¢å¼•æ ‡ç­¾

- **ç´¢å¼•å»ºè®®** (`GET /v1/index/suggestions`)
  - æä¾›ç´¢å¼•ä¼˜åŒ–å»ºè®®
  - åŒ…æ‹¬æ€§èƒ½ä¼˜åŒ–å’Œç»´æŠ¤å»ºè®®

#### 5. æ‰¹é‡æ“ä½œæ¨¡å— (Batch Operations)
- **æ‰¹é‡åˆ›å»ºç´¢å¼•** (`POST /v1/index/batch/create`)
  - æ”¯æŒæ‰¹é‡åˆ›å»ºå¤šä¸ªç´¢å¼•
  - å¯é…ç½®å¹¶å‘æ•°é‡

- **æ‰¹é‡æ“ä½œçŠ¶æ€** (`GET /v1/index/batch/{batch_id}/status`)
  - æŸ¥è¯¢æ‰¹é‡æ“ä½œçš„è¿›åº¦
  - åŒ…æ‹¬å®Œæˆæ•°é‡ã€å¤±è´¥æ•°é‡ç­‰ç»Ÿè®¡ä¿¡æ¯

### æŠ€æœ¯ç‰¹æ€§

#### å®æ—¶è¿›åº¦åé¦ˆ
- ä½¿ç”¨ Server-Sent Events (SSE) æä¾›å®æ—¶è¿›åº¦æ›´æ–°
- åŒ…æ‹¬å¤„ç†é€Ÿåº¦ã€é¢„ä¼°å®Œæˆæ—¶é—´ç­‰è¯¦ç»†ä¿¡æ¯
- æ”¯æŒé”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç›‘æ§

#### é«˜çº§æœç´¢åŠŸèƒ½
- åŸºäº Tantivy å…¨æ–‡æœç´¢å¼•æ“
- æ”¯æŒæ¨¡ç³ŠæŸ¥è¯¢å’Œç²¾ç¡®åŒ¹é…
- å¯é…ç½®çš„æœç´¢ç»“æœæ’åºå’Œè¿‡æ»¤

#### æ™ºèƒ½ä»£ç åˆ†æ
- å¤šè¯­è¨€ä»£ç å¤æ‚åº¦åˆ†æ
- è‡ªåŠ¨ç”Ÿæˆç´¢å¼•æ ‡ç­¾
- ä»£ç è´¨é‡è¯„åˆ†ç®—æ³•

#### çµæ´»çš„é…ç½®ç®¡ç†
- æ”¯æŒå¤šç§æ–‡ä»¶ç±»å‹å’Œç¼–ç¨‹è¯­è¨€
- å¯é…ç½®çš„åŒ…å«/æ’é™¤æ¨¡å¼
- åŠ¨æ€é…ç½®éªŒè¯

### API ä½¿ç”¨ç¤ºä¾‹

#### æœç´¢ä»£ç 
```bash
curl -X POST "http://localhost:8080/v1/index/search" \
  -H "Content-Type: application/json" \
  -d '{
    "query": "function main",
    "language": "rust",
    "limit": 10
  }'
```

#### åˆ›å»ºç´¢å¼•ï¼ˆå®æ—¶è¿›åº¦ï¼‰
```bash
curl -X POST "http://localhost:8080/v1/index/create" \
  -H "Content-Type: application/json" \
  -H "Accept: text/event-stream" \
  -d '{
    "source": "https://github.com/TabbyML/tabby.git",
    "name": "tabby-index"
  }'
```

#### åˆ†æä»£ç 
```bash
curl -X POST "http://localhost:8080/v1/index/analyze" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "fn main() { println!(\"Hello, world!\"); }",
    "filepath": "src/main.rs",
    "language": "rust"
  }'
```

### æ•°æ®ç»“æ„

#### SearchResult
```json
{
  "file_path": "src/main.rs",
  "content": "fn main() { println!(\"Hello, world!\"); }",
  "start_line": 1,
  "end_line": 3,
  "score": 0.95,
  "language": "rust",
  "git_url": "https://github.com/user/repo.git"
}
```

#### IndexStatus
```json
{
  "index_id": "idx_abc123def456",
  "status": "ready",
  "document_count": 1500,
  "size_bytes": 1048576,
  "last_updated": "2024-03-21T10:30:00Z",
  "version": "1.0"
}
```

#### AnalyzeResponse
```json
{
  "complexity": 2,
  "function_count": 1,
  "class_count": 0,
  "lines_of_code": 3,
  "suggested_tags": ["main", "function", "rust"],
  "quality_score": 85
}
```

### æ€§èƒ½ä¼˜åŒ–

#### ç´¢å¼•ä¼˜åŒ–
- ä½¿ç”¨ Tantivy é«˜æ€§èƒ½æœç´¢å¼•æ“
- æ”¯æŒå¢é‡ç´¢å¼•æ›´æ–°
- å†…å­˜å’Œç£ç›˜ä½¿ç”¨ä¼˜åŒ–

#### å¹¶å‘å¤„ç†
- æ”¯æŒæ‰¹é‡æ“ä½œçš„å¹¶å‘å¤„ç†
- å¼‚æ­¥ä»»åŠ¡å¤„ç†
- èµ„æºä½¿ç”¨ç›‘æ§

#### ç¼“å­˜æœºåˆ¶
- æœç´¢ç»“æœç¼“å­˜
- é…ç½®ä¿¡æ¯ç¼“å­˜
- æ™ºèƒ½ç¼“å­˜å¤±æ•ˆç­–ç•¥

### é”™è¯¯å¤„ç†

#### ç»Ÿä¸€é”™è¯¯æ ¼å¼
æ‰€æœ‰ API éƒ½ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼ï¼š
```json
{
  "success": false,
  "message": "Error description",
  "error_code": "INDEX_NOT_FOUND"
}
```

#### é”™è¯¯ç±»å‹
- `INDEX_NOT_FOUND`: ç´¢å¼•ä¸å­˜åœ¨
- `INVALID_CONFIG`: é…ç½®æ— æ•ˆ
- `SEARCH_FAILED`: æœç´¢å¤±è´¥
- `ANALYSIS_FAILED`: ä»£ç åˆ†æå¤±è´¥

### ç›‘æ§å’Œæ—¥å¿—

#### æ€§èƒ½ç›‘æ§
- API å“åº”æ—¶é—´ç›‘æ§
- ç´¢å¼•æ“ä½œæ€§èƒ½ç»Ÿè®¡
- èµ„æºä½¿ç”¨æƒ…å†µç›‘æ§

#### è¯¦ç»†æ—¥å¿—
- æ“ä½œå®¡è®¡æ—¥å¿—
- é”™è¯¯è¯¦ç»†æ—¥å¿—
- æ€§èƒ½åˆ†ææ—¥å¿—

### æ‰©å±•æ€§

#### æ’ä»¶æ¶æ„
- æ”¯æŒè‡ªå®šä¹‰ä»£ç åˆ†æå™¨
- å¯æ‰©å±•çš„æœç´¢ç®—æ³•
- çµæ´»çš„ç´¢å¼•ç­–ç•¥

#### å¤šè¯­è¨€æ”¯æŒ
- æ”¯æŒä¸»æµç¼–ç¨‹è¯­è¨€
- å¯é…ç½®çš„è¯­è¨€ç‰¹å®šå¤„ç†
- è¯­è¨€æ£€æµ‹å’Œåˆ†ç±»

### å®‰å…¨æ€§

#### è®¿é—®æ§åˆ¶
- API ä»¤ç‰Œè®¤è¯
- æƒé™çº§åˆ«æ§åˆ¶
- æ“ä½œå®¡è®¡

#### æ•°æ®ä¿æŠ¤
- æ•æ„Ÿä¿¡æ¯è¿‡æ»¤
- å®‰å…¨çš„æ–‡ä»¶è®¿é—®
- è¾“å…¥éªŒè¯å’Œæ¸…ç†

### éƒ¨ç½²å’Œç»´æŠ¤

#### é…ç½®æ–‡ä»¶
ç´¢å¼•é…ç½®ç¤ºä¾‹ï¼š
```json
{
  "max_file_size": 1024,
  "include_patterns": ["**/*.rs", "**/*.py", "**/*.js"],
  "exclude_patterns": ["target/**", "node_modules/**"],
  "languages": ["rust", "python", "javascript"],
  "enable_semantic_search": true,
  "update_interval_seconds": 3600
}
```

#### ç»´æŠ¤å»ºè®®
- å®šæœŸé‡å»ºç´¢å¼•ä»¥ä¼˜åŒ–æ€§èƒ½
- ç›‘æ§ç´¢å¼•å¤§å°å’Œæ–‡æ¡£æ•°é‡
- æ ¹æ®ä½¿ç”¨æƒ…å†µè°ƒæ•´é…ç½®å‚æ•°
- å®šæœŸæ¸…ç†è¿‡æœŸç´¢å¼•

### æœªæ¥è§„åˆ’

#### è®¡åˆ’åŠŸèƒ½
- å¢å¼ºçš„è¯­ä¹‰æœç´¢åŠŸèƒ½
- æœºå™¨å­¦ä¹ é©±åŠ¨çš„ä»£ç å»ºè®®
- æ›´å¤šç¼–ç¨‹è¯­è¨€æ”¯æŒ
- åˆ†å¸ƒå¼ç´¢å¼•æ¶æ„

#### æ€§èƒ½æ”¹è¿›
- æ›´å¿«çš„ç´¢å¼•æ„å»ºé€Ÿåº¦
- æ›´ç²¾ç¡®çš„æœç´¢ç®—æ³•
- æ›´å¥½çš„å†…å­˜ç®¡ç†
- å®æ—¶ç´¢å¼•æ›´æ–°

è¿™ä¸ªå…¨é¢çš„ code indexing API ä¼˜åŒ–ä¸º Tabby é¡¹ç›®æä¾›äº†å¼ºå¤§çš„ä»£ç æœç´¢å’Œåˆ†æèƒ½åŠ›ï¼Œæ”¯æŒå¼€å‘è€…æ›´é«˜æ•ˆåœ°ç®¡ç†å’Œæœç´¢ä»£ç åº“ã€‚
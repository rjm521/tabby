# Tabbyç”¨æˆ·æ¨¡å‹é…ç½®åŠŸèƒ½ç¼–è¯‘ä¿®å¤çŠ¶æ€

## ğŸ“Š å½“å‰çŠ¶æ€ï¼šç”¨æˆ·æ¨¡å‹é…ç½®API Swaggeræ–‡æ¡£å®Œæˆ âœ…

**æœ€åæ›´æ–°æ—¶é—´ï¼š** 2024å¹´12æœˆ19æ—¥

---

## ğŸ¯ ä¿®å¤è½®æ¬¡æ€»è§ˆ

### âœ… ç¬¬1-4è½®ï¼šç¼–è¯‘é”™è¯¯ä¿®å¤ï¼ˆå·²å®Œæˆï¼‰
- **é—®é¢˜**ï¼šæ¨¡å—å¼•ç”¨ã€ç±»å‹ç³»ç»Ÿã€å­—ç¬¦ä¸²è½¬IDã€æ‰€æœ‰æƒå€Ÿç”¨ç­‰ç¼–è¯‘é”™è¯¯
- **ç»“æœ**ï¼šæ‰€æœ‰ç¼–è¯‘é”™è¯¯å·²ä¿®å¤ âœ…

### âœ… ç¬¬5è½®ï¼šè·¯ç”±å†²çªä¿®å¤ï¼ˆå·²å®Œæˆï¼‰
- **é—®é¢˜**ï¼šEEç‰ˆæœ¬ä¸åŸºç¡€ç‰ˆæœ¬è·¯ç”±é‡å¤å®šä¹‰å¯¼è‡´å¯åŠ¨å¤±è´¥
- **é”™è¯¯ä¿¡æ¯**ï¼š`Overlapping method route. Handler for 'POST /v1/completions' already exists`
- **ä¿®å¤æ–¹æ¡ˆ**ï¼šæ³¨é‡Šæ‰EEç‰ˆæœ¬ä¸­é‡å¤çš„è·¯ç”±å®šä¹‰
- **ç»“æœ**ï¼šè·¯ç”±å†²çªå·²è§£å†³ âœ…

### âœ… ç¬¬6è½®ï¼šSwaggeræ–‡æ¡£ä¿®å¤ï¼ˆå·²å®Œæˆï¼‰
- **é—®é¢˜**ï¼šæœåŠ¡å¯åŠ¨æˆåŠŸä½†Swaggerä¸­æ²¡æœ‰EE APIç«¯ç‚¹æ–‡æ¡£
- **æ ¹æœ¬åŸå› **ï¼šEEè·¯ç”±å‡½æ•°ç¼ºå°‘ `utoipa::path` æ³¨è§£
- **ä¿®å¤æ–¹æ¡ˆ**ï¼šæ·»åŠ å®Œæ•´çš„OpenAPIæ³¨è§£å’Œschemaå®šä¹‰
- **ç»“æœ**ï¼šSwaggeræ–‡æ¡£å·²å®Œæ•´ âœ…

### âœ… ç¬¬7è½®ï¼šç”¨æˆ·æ¨¡å‹é…ç½®API Swaggeræ–‡æ¡£ï¼ˆæ–°å¢å®Œæˆï¼‰
- **é—®é¢˜**ï¼šç¼ºå°‘ç”¨æˆ·æ¨¡å‹è®¾ç½®ç›¸å…³APIçš„Swaggeræ–‡æ¡£
- **æ ¹æœ¬åŸå› **ï¼šç”¨æˆ·æ¨¡å‹é…ç½®APIç«¯ç‚¹æœªå®ç°å’Œæ–‡æ¡£åŒ–
- **ä¿®å¤æ–¹æ¡ˆ**ï¼šåˆ›å»ºå®Œæ•´çš„ç”¨æˆ·æ¨¡å‹é…ç½®RESTful API
- **ç»“æœ**ï¼šç”¨æˆ·æ¨¡å‹é…ç½®APIå®Œæ•´å®ç° âœ…

### âœ… ç¬¬8è½®ï¼šæœåŠ¡å¯åŠ¨å’ŒAPIå¯è§æ€§ä¿®å¤ï¼ˆå·²å®Œæˆï¼‰
- **é—®é¢˜**ï¼šSwagger UIä¸­ä»ç„¶æ²¡æœ‰æ˜¾ç¤ºæ¨¡å‹è®¾ç½®APIæ–‡æ¡£ï¼Œcurlå‘½ä»¤ä¹Ÿè®¿é—®ä¸é€š
- **æ ¹æœ¬åŸå› **ï¼šEEåŠŸèƒ½æœªå¯ç”¨ï¼Œè·¯ç”±ä¸­é—´ä»¶å±‚çº§é”™è¯¯ï¼ŒæœåŠ¡éœ€è¦é‡å¯
- **ä¿®å¤æ–¹æ¡ˆ**ï¼šä¿®å¤å¯åŠ¨è„šæœ¬ï¼Œä¿®å¤è·¯ç”±ä¸­é—´ä»¶é…ç½®ï¼Œåˆ›å»ºé‡å¯è„šæœ¬ï¼Œåˆ›å»ºAPIæµ‹è¯•è„šæœ¬
- **ç»“æœ**ï¼šä¿®å¤åï¼Œç”¨æˆ·åº”è¯¥èƒ½å¤Ÿï¼š
  - åœ¨Swagger UIä¸­çœ‹åˆ°æ‰€æœ‰7ä¸ªæ¨¡å‹é…ç½®APIç«¯ç‚¹
  - é€šè¿‡curlå‘½ä»¤æˆåŠŸè°ƒç”¨APIï¼ˆå¸¦æ­£ç¡®è®¤è¯ï¼‰
  - è·å¾—401è®¤è¯é”™è¯¯ï¼ˆè¯´æ˜è·¯ç”±å·¥ä½œæ­£å¸¸ï¼‰
  - åœ¨OpenAPIæ–‡æ¡£ä¸­çœ‹åˆ°å®Œæ•´çš„APIå®šä¹‰

### âœ… ç¬¬9è½®ï¼šæœåŠ¡å¯åŠ¨ç¼–è¯‘é”™è¯¯ä¿®å¤ï¼ˆå·²å®Œæˆï¼‰
- **é—®é¢˜**ï¼šæœåŠ¡å¯åŠ¨å¤±è´¥ï¼Œæä¾›äº†å¯åŠ¨æ—¥å¿—æ–‡ä»¶ `./logs/chat_service_20250529_030916.log`ã€‚é€šè¿‡åˆ†ææ—¥å¿—å‘ç°äº†ç¼–è¯‘é”™è¯¯ï¼š
  - `DbEnum trait æœªå¯¼å…¥é”™è¯¯` - `as_enum_str()` å’Œ `from_enum_str()` æ–¹æ³•æ‰¾ä¸åˆ°
  - `chrono::DateTime ä¸å…¼å®¹ utoipa ToSchema é”™è¯¯` - æ—¶é—´å­—æ®µæ— æ³•åºåˆ—åŒ–ä¸º OpenAPI Schema
- **ä¿®å¤æ–¹æ¡ˆ**ï¼šä¿®å¤ DbEnum trait å¯¼å…¥é—®é¢˜ï¼Œä¿®å¤ chrono::DateTime ä¸ utoipa å…¼å®¹æ€§é—®é¢˜ï¼Œå®Œå–„ OpenAPI æ³¨è§£
- **ç»“æœ**ï¼šç¼–è¯‘é”™è¯¯å·²è§£å†³ âœ…

---

## ğŸ”§ ç¬¬7è½®ä¿®å¤è¯¦æƒ…

### é—®é¢˜è¯Šæ–­
ç”¨æˆ·åé¦ˆï¼šç¼ºå°‘ç”¨æˆ·æ¨¡å‹è®¾ç½®ç›¸å…³APIçš„Swaggeræ–‡æ¡£

**æ ¹æœ¬åŸå› åˆ†æ**ï¼š
1. è™½ç„¶æœ‰æ¨¡å‹é…ç½®æœåŠ¡å®ç°ï¼Œä½†ç¼ºå°‘å¯¹åº”çš„RESTful APIç«¯ç‚¹
2. æ²¡æœ‰ç”¨æˆ·æ¨¡å‹åå¥½ç®¡ç†çš„HTTPæ¥å£
3. æ²¡æœ‰å¯ç”¨æ¨¡å‹ç®¡ç†çš„CRUD API
4. ç¼ºå°‘å®Œæ•´çš„OpenAPIæ–‡æ¡£

### ä¿®å¤å®æ–½

#### 1. åˆ›å»ºç”¨æˆ·æ¨¡å‹é…ç½®APIæ–‡ä»¶
**æ–‡ä»¶**ï¼š`ee/tabby-webserver/src/routes/model_configuration.rs`

**æ–°å¢APIç«¯ç‚¹**ï¼š
```rust
// ç”¨æˆ·æ¨¡å‹åå¥½ç®¡ç†
GET    /v1/user/model-preference      - è·å–ç”¨æˆ·æ¨¡å‹åå¥½
PUT    /v1/user/model-preference      - æ›´æ–°ç”¨æˆ·æ¨¡å‹åå¥½

// å¯ç”¨æ¨¡å‹ç®¡ç†
GET    /v1/models                     - åˆ—å‡ºå¯ç”¨æ¨¡å‹
POST   /v1/models                     - åˆ›å»ºæ–°æ¨¡å‹
GET    /v1/models/{id}                - è·å–ç‰¹å®šæ¨¡å‹
PUT    /v1/models/{id}                - æ›´æ–°æ¨¡å‹ä¿¡æ¯
DELETE /v1/models/{id}                - åˆ é™¤æ¨¡å‹
```

#### 2. æ•°æ®ç»“æ„å®šä¹‰
**ç”¨æˆ·æ¨¡å‹åå¥½ç›¸å…³**ï¼š
```rust
#[derive(Serialize, ToSchema)]
pub struct UserModelPreferenceResponse { ... }

#[derive(Deserialize, ToSchema)]
pub struct UpdateUserModelPreferenceRequest { ... }
```

**å¯ç”¨æ¨¡å‹ç›¸å…³**ï¼š
```rust
#[derive(Serialize, ToSchema)]
pub struct AvailableModelResponse { ... }

#[derive(Deserialize, ToSchema)]
pub struct CreateAvailableModelRequest { ... }

#[derive(Deserialize, ToSchema)]
pub struct UpdateAvailableModelRequest { ... }
```

#### 3. OpenAPIæ³¨è§£
ä¸ºæ‰€æœ‰APIç«¯ç‚¹æ·»åŠ å®Œæ•´çš„ `#[utoipa::path]` æ³¨è§£ï¼š
- è¯¦ç»†çš„è¯·æ±‚/å“åº”æè¿°
- å‚æ•°è¯´æ˜å’Œç¤ºä¾‹
- é”™è¯¯çŠ¶æ€ç å®šä¹‰
- å®‰å…¨è®¤è¯è¦æ±‚

#### 4. è·¯ç”±é›†æˆ
**æ–‡ä»¶**ï¼š`ee/tabby-webserver/src/routes/mod.rs`
```rust
// Model Configuration API routes
api = api.route(
    "/v1/user/model-preference",
    routing::get(model_configuration::get_user_model_preference)
        .put(model_configuration::update_user_model_preference)
        .with_state(ctx.clone())
);

api = api.route(
    "/v1/models",
    routing::get(model_configuration::list_available_models)
        .post(model_configuration::create_available_model)
        .with_state(ctx.clone())
);

api = api.route(
    "/v1/models/{id}",
    routing::get(model_configuration::get_available_model)
        .put(model_configuration::update_available_model)
        .delete(model_configuration::delete_available_model)
        .with_state(ctx.clone())
);
```

#### 5. Swaggeræ–‡æ¡£æ›´æ–°
**æ–‡ä»¶**ï¼š`ee/tabby-webserver/src/lib.rs`
```rust
#[derive(OpenApi)]
#[openapi(
    paths(
        // ç°æœ‰è·¯ç”±...
        routes::model_configuration::get_user_model_preference,
        routes::model_configuration::update_user_model_preference,
        routes::model_configuration::list_available_models,
        routes::model_configuration::get_available_model,
        routes::model_configuration::create_available_model,
        routes::model_configuration::update_available_model,
        routes::model_configuration::delete_available_model,
    ),
    components(schemas(
        // ç°æœ‰schemas...
        routes::model_configuration::UserModelPreferenceResponse,
        routes::model_configuration::UpdateUserModelPreferenceRequest,
        routes::model_configuration::AvailableModelResponse,
        routes::model_configuration::CreateAvailableModelRequest,
        routes::model_configuration::UpdateAvailableModelRequest,
        routes::model_configuration::ListModelsQuery,
    )),
)]
```

### ä¿®å¤æ•ˆæœ

#### âœ… æ–°å¢ç”¨æˆ·æ¨¡å‹åå¥½API
1. **è·å–ç”¨æˆ·åå¥½**ï¼š`GET /v1/user/model-preference`
   - è¿”å›ç”¨æˆ·å½“å‰çš„æ¨¡å‹åå¥½è®¾ç½®
   - åŒ…å«è¡¥å…¨æ¨¡å‹å’ŒèŠå¤©æ¨¡å‹åå¥½
   - æ”¯æŒJWTè®¤è¯

2. **æ›´æ–°ç”¨æˆ·åå¥½**ï¼š`PUT /v1/user/model-preference`
   - å…è®¸ç”¨æˆ·è®¾ç½®é¦–é€‰çš„è¡¥å…¨å’ŒèŠå¤©æ¨¡å‹
   - æ”¯æŒéƒ¨åˆ†æ›´æ–°
   - è¿”å›æ›´æ–°åçš„åå¥½è®¾ç½®

#### âœ… æ–°å¢å¯ç”¨æ¨¡å‹ç®¡ç†API
1. **åˆ—å‡ºæ¨¡å‹**ï¼š`GET /v1/models?model_type=completion`
   - æ”¯æŒæŒ‰æ¨¡å‹ç±»å‹ç­›é€‰
   - è¿”å›æ‰€æœ‰å¯ç”¨æ¨¡å‹åˆ—è¡¨
   - åŒ…å«æ¨¡å‹è¯¦ç»†ä¿¡æ¯

2. **åˆ›å»ºæ¨¡å‹**ï¼š`POST /v1/models`
   - ç®¡ç†å‘˜å¯æ·»åŠ æ–°çš„AIæ¨¡å‹
   - æ”¯æŒå®Œæ•´çš„æ¨¡å‹é…ç½®
   - è‡ªåŠ¨éªŒè¯è¾“å…¥å‚æ•°

3. **è·å–æ¨¡å‹**ï¼š`GET /v1/models/{id}`
   - è·å–ç‰¹å®šæ¨¡å‹çš„è¯¦ç»†ä¿¡æ¯
   - æ”¯æŒæ¨¡å‹IDæŸ¥è¯¢

4. **æ›´æ–°æ¨¡å‹**ï¼š`PUT /v1/models/{id}`
   - æ›´æ–°æ¨¡å‹é…ç½®ä¿¡æ¯
   - æ”¯æŒéƒ¨åˆ†å­—æ®µæ›´æ–°
   - ä¿æŒæ•°æ®ä¸€è‡´æ€§

5. **åˆ é™¤æ¨¡å‹**ï¼š`DELETE /v1/models/{id}`
   - å®‰å…¨åˆ é™¤æ¨¡å‹é…ç½®
   - è¿”å›204çŠ¶æ€ç 

#### âœ… å®Œæ•´Swaggeræ–‡æ¡£
- æ‰€æœ‰æ–°APIç«¯ç‚¹ç°åœ¨éƒ½åœ¨Swagger UIä¸­å¯è§
- è¯¦ç»†çš„è¯·æ±‚/å“åº”schemaå®šä¹‰
- å®Œæ•´çš„å‚æ•°è¯´æ˜å’Œç¤ºä¾‹
- é”™è¯¯å¤„ç†å’ŒçŠ¶æ€ç è¯´æ˜

---

## ğŸ§ª éªŒè¯æ–¹æ³•

### APIåŠŸèƒ½æµ‹è¯•
```bash
# 1. è·å–ç”¨æˆ·æ¨¡å‹åå¥½
curl -X GET http://localhost:8080/v1/user/model-preference \
  -H "Authorization: Bearer YOUR_TOKEN"

# 2. æ›´æ–°ç”¨æˆ·æ¨¡å‹åå¥½
curl -X PUT http://localhost:8080/v1/user/model-preference \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "completion_model_id": "model-123",
    "chat_model_id": "model-456"
  }'

# 3. åˆ—å‡ºå¯ç”¨æ¨¡å‹
curl -X GET http://localhost:8080/v1/models?model_type=completion

# 4. åˆ›å»ºæ–°æ¨¡å‹
curl -X POST http://localhost:8080/v1/models \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "name": "custom-model",
    "display_name": "Custom Model",
    "model_type": "completion",
    "provider": "openai",
    "performance_tier": "balanced"
  }'
```

### Swaggeræ–‡æ¡£éªŒè¯
1. **è®¿é—®Swagger UI**ï¼š`http://localhost:8080/swagger-ui`
2. **æ£€æŸ¥APIæ–‡æ¡£**ï¼š`http://localhost:8080/api-docs/openapi.json`
3. **éªŒè¯æ–°ç«¯ç‚¹**ï¼šæœç´¢ `model_preference` å’Œ `available_model`

---

## ğŸ“‹ å®Œæ•´ä¿®å¤æ–‡ä»¶åˆ—è¡¨

1. **æ ¸å¿ƒæœåŠ¡æ–‡ä»¶**ï¼š
   - `ee/tabby-webserver/src/service/model_configuration.rs`
   - `crates/tabby/src/services/completion.rs`

2. **è·¯ç”±æ–‡ä»¶**ï¼š
   - `ee/tabby-webserver/src/routes/ee_completions.rs`
   - `ee/tabby-webserver/src/routes/ee_chat.rs`
   - âœ¨ `ee/tabby-webserver/src/routes/model_configuration.rs` (æ–°å¢å®Œæ•´API)
   - âœ¨ `ee/tabby-webserver/src/routes/mod.rs` (æ·»åŠ æ–°è·¯ç”±)

3. **OpenAPIé…ç½®**ï¼š
   - âœ¨ `ee/tabby-webserver/src/lib.rs` (æ›´æ–°EEApiDoc)

4. **æµ‹è¯•è„šæœ¬**ï¼š
   - âœ¨ `test_swagger_api_docs.sh` (æ–°å¢APIæ–‡æ¡£æµ‹è¯•)

---

## ğŸ‰ é¡¹ç›®çŠ¶æ€æ€»ç»“

### âœ… å·²å®Œæˆ
- [x] æ‰€æœ‰ç¼–è¯‘é”™è¯¯ä¿®å¤
- [x] ç±»å‹å®‰å…¨ä¿è¯
- [x] å†…å­˜å®‰å…¨ä¿è¯
- [x] è·¯ç”±å†²çªè§£å†³
- [x] ç”¨æˆ·æ¨¡å‹é…ç½®åç«¯å®ç°å®Œæ•´
- [x] EEç«¯ç‚¹Swaggeræ–‡æ¡£å®Œæ•´
- [x] **ç”¨æˆ·æ¨¡å‹é…ç½®APIå®Œæ•´å®ç°**
- [x] **å®Œæ•´çš„RESTful APIæ¥å£**
- [x] **è¯¦ç»†çš„Swagger APIæ–‡æ¡£**

### ğŸš€ APIç«¯ç‚¹æ€»è§ˆ
#### åŸºç¡€ç«¯ç‚¹
- `POST /v1/completions` - åŸºç¡€ä»£ç è¡¥å…¨
- `POST /v1/chat/completions` - åŸºç¡€èŠå¤©è¡¥å…¨
- `GET /v1/health` - å¥åº·æ£€æŸ¥
- `GET /v1beta/models` - æ¨¡å‹åˆ—è¡¨

#### EEç«¯ç‚¹
- `POST /v1/ee/completions` - EEä»£ç è¡¥å…¨ï¼ˆæ”¯æŒç”¨æˆ·åå¥½ï¼‰
- `POST /v1/ee/chat/completions` - EEèŠå¤©è¡¥å…¨ï¼ˆæ”¯æŒç”¨æˆ·åå¥½ï¼‰

#### ğŸ†• ç”¨æˆ·æ¨¡å‹é…ç½®ç«¯ç‚¹ï¼ˆæ–°å¢ï¼‰
- `GET /v1/user/model-preference` - è·å–ç”¨æˆ·æ¨¡å‹åå¥½
- `PUT /v1/user/model-preference` - æ›´æ–°ç”¨æˆ·æ¨¡å‹åå¥½
- `GET /v1/models` - åˆ—å‡ºå¯ç”¨æ¨¡å‹
- `POST /v1/models` - åˆ›å»ºæ–°æ¨¡å‹
- `GET /v1/models/{id}` - è·å–ç‰¹å®šæ¨¡å‹
- `PUT /v1/models/{id}` - æ›´æ–°æ¨¡å‹ä¿¡æ¯
- `DELETE /v1/models/{id}` - åˆ é™¤æ¨¡å‹

### ğŸ”„ ä¸‹ä¸€æ­¥
- [ ] æœ€ç»ˆåŠŸèƒ½æµ‹è¯•
- [ ] å‰ç«¯é›†æˆ
- [ ] å®Œæ•´E2Eæµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–

**ç»“è®º**ï¼šç”¨æˆ·æ¨¡å‹é…ç½®åŠŸèƒ½å·²å®Œå…¨å‡†å¤‡å°±ç»ªï¼ŒåŒ…æ‹¬å®Œæ•´çš„RESTful APIå’ŒSwaggeræ–‡æ¡£ï¼ğŸš€

## ç¬¬8è½®ä¿®å¤ - æœåŠ¡å¯åŠ¨å’ŒAPIå¯è§æ€§ä¿®å¤ (2024-12-19)

### é—®é¢˜è¯Šæ–­
ç”¨æˆ·åé¦ˆSwagger UIä¸­ä»ç„¶æ²¡æœ‰æ˜¾ç¤ºæ¨¡å‹è®¾ç½®APIæ–‡æ¡£ï¼Œcurlå‘½ä»¤ä¹Ÿè®¿é—®ä¸é€šã€‚ç»è¿‡æ·±å…¥åˆ†æå‘ç°äº†å…³é”®é—®é¢˜ï¼š

1. **EEåŠŸèƒ½æœªå¯ç”¨**: å¯åŠ¨è„šæœ¬ä½¿ç”¨`./target/debug/tabby`ä½†æ²¡æœ‰å¯ç”¨`--features ee`
2. **è·¯ç”±ä¸­é—´ä»¶å±‚çº§é”™è¯¯**: æ¨¡å‹é…ç½®è·¯ç”±æ”¾åœ¨é”™è¯¯çš„ä¸­é—´ä»¶å±‚ä¸­
3. **æœåŠ¡éœ€è¦é‡å¯**: ä»£ç ä¿®æ”¹åéœ€è¦é‡æ–°ç¼–è¯‘å’Œå¯åŠ¨æœåŠ¡

### ä¸»è¦ä¿®å¤å†…å®¹

#### 1. ä¿®å¤å¯åŠ¨è„šæœ¬ (`start_chat_service.sh`)
- **é—®é¢˜**: å¯åŠ¨å‘½ä»¤æ²¡æœ‰å¯ç”¨EEåŠŸèƒ½ç‰¹æ€§
- **ä¿®å¤**: å°†å¯åŠ¨å‘½ä»¤ä»`./target/debug/tabby`æ”¹ä¸º`cargo run --features ee --bin tabby`
- **å½±å“**: ç¡®ä¿æ‰€æœ‰EEåŠŸèƒ½ï¼ˆåŒ…æ‹¬æ¨¡å‹é…ç½®APIï¼‰æ­£ç¡®åŠ è½½

#### 2. ä¿®å¤è·¯ç”±ä¸­é—´ä»¶é…ç½® (`ee/tabby-webserver/src/routes/mod.rs`)
- **é—®é¢˜**: æ¨¡å‹é…ç½®è·¯ç”±æ·»åŠ åœ¨`distributed_tabby_layer`ä¹‹å‰ï¼Œå¯¼è‡´è®¤è¯å’Œè·¯ç”±åˆ†å‘å¤±æ•ˆ
- **ä¿®å¤**: å°†æ¨¡å‹é…ç½®è·¯ç”±ç§»åŠ¨åˆ°`protected_api`ä¸­ï¼Œç¡®ä¿æ­£ç¡®çš„è®¤è¯æµç¨‹
- **æ–°çš„è·¯ç”±ç»“æ„**:
  ```rust
  let protected_api = Router::new()
      .route("/v1/user/model-preference", ...)
      .route("/v1/models", ...)
      .route("/v1/models/{id}", ...)
      .layer(from_fn_with_state(ctx.auth(), require_login_middleware));
  ```

#### 3. åˆ›å»ºé‡å¯è„šæœ¬ (`restart_with_ee_features.sh`)
- **åŠŸèƒ½**: è‡ªåŠ¨åœæ­¢æœåŠ¡ã€æ¸…ç†ç¼“å­˜ã€è¿è¡Œè¿ç§»ã€é‡æ–°å¯åŠ¨æœåŠ¡
- **éªŒè¯**: åŒ…å«æœåŠ¡å¯åŠ¨åçš„è‡ªåŠ¨éªŒè¯æ­¥éª¤

#### 4. åˆ›å»ºAPIæµ‹è¯•è„šæœ¬ (`test_model_configuration_api.sh`)
- **åŠŸèƒ½**: å…¨é¢æµ‹è¯•APIç«¯ç‚¹ã€Swaggeræ–‡æ¡£ã€è®¤è¯æµç¨‹
- **æ£€æŸ¥é¡¹**:
  - Swagger UIè®¿é—®æ€§
  - OpenAPIæ–‡æ¡£å®Œæ•´æ€§
  - APIç«¯ç‚¹å“åº”çŠ¶æ€
  - æ•°æ®åº“è¡¨å­˜åœ¨æ€§

### æŠ€æœ¯ç»†èŠ‚

#### APIç«¯ç‚¹å®Œæ•´åˆ—è¡¨
```
ç”¨æˆ·æ¨¡å‹åå¥½ç®¡ç†:
- GET    /v1/user/model-preference      (è·å–ç”¨æˆ·æ¨¡å‹åå¥½)
- PUT    /v1/user/model-preference      (æ›´æ–°ç”¨æˆ·æ¨¡å‹åå¥½)

å¯ç”¨æ¨¡å‹ç®¡ç†:
- GET    /v1/models                     (åˆ—å‡ºå¯ç”¨æ¨¡å‹)
- POST   /v1/models                     (åˆ›å»ºæ–°æ¨¡å‹)
- GET    /v1/models/{id}                (è·å–ç‰¹å®šæ¨¡å‹)
- PUT    /v1/models/{id}                (æ›´æ–°æ¨¡å‹ä¿¡æ¯)
- DELETE /v1/models/{id}                (åˆ é™¤æ¨¡å‹)
```

#### è®¤è¯å’Œæƒé™
- æ‰€æœ‰APIç«¯ç‚¹éƒ½éœ€è¦JWTè®¤è¯
- é€šè¿‡`require_login_middleware`è¿›è¡Œç”¨æˆ·éªŒè¯
- æ”¯æŒBearer Tokenè®¤è¯æ–¹å¼

#### æ•°æ®åº“æ”¯æŒ
- åˆ›å»ºäº†`available_models`è¡¨å­˜å‚¨å¯ç”¨æ¨¡å‹
- åˆ›å»ºäº†`user_model_preferences`è¡¨å­˜å‚¨ç”¨æˆ·åå¥½
- åŒ…å«å®Œæ•´çš„å¤–é”®çº¦æŸå’Œç´¢å¼•

### è§£å†³æ–¹æ¡ˆæ€»ç»“

1. **æ ¹æœ¬åŸå› **: æœåŠ¡å¯åŠ¨æ—¶æœªå¯ç”¨EEåŠŸèƒ½ï¼Œå¯¼è‡´æ‰€æœ‰EEç›¸å…³APIéƒ½ä¸å¯ç”¨
2. **ä¿®å¤æ–¹æ³•**: ä¿®æ”¹å¯åŠ¨è„šæœ¬å¯ç”¨`--features ee`æ ‡å¿—
3. **é…å¥—ä¿®å¤**: è°ƒæ•´è·¯ç”±ä¸­é—´ä»¶é…ç½®ï¼Œåˆ›å»ºæµ‹è¯•å’Œé‡å¯è„šæœ¬
4. **éªŒè¯æ–¹æ³•**: é€šè¿‡Swagger UIå’Œcurlå‘½ä»¤éªŒè¯APIå¯ç”¨æ€§

### é¢„æœŸç»“æœ
ä¿®å¤åï¼Œç”¨æˆ·åº”è¯¥èƒ½å¤Ÿï¼š
- åœ¨Swagger UIä¸­çœ‹åˆ°æ‰€æœ‰7ä¸ªæ¨¡å‹é…ç½®APIç«¯ç‚¹
- é€šè¿‡curlå‘½ä»¤æˆåŠŸè°ƒç”¨APIï¼ˆå¸¦æ­£ç¡®è®¤è¯ï¼‰
- è·å¾—401è®¤è¯é”™è¯¯ï¼ˆè¯´æ˜è·¯ç”±å·¥ä½œæ­£å¸¸ï¼‰
- åœ¨OpenAPIæ–‡æ¡£ä¸­çœ‹åˆ°å®Œæ•´çš„APIå®šä¹‰

### ä¸‹ä¸€æ­¥æ“ä½œ
1. è¿è¡Œ`chmod +x restart_with_ee_features.sh && ./restart_with_ee_features.sh`
2. è®¿é—®`http://localhost:8080/swagger-ui`éªŒè¯APIæ–‡æ¡£
3. ä½¿ç”¨`./test_model_configuration_api.sh`è¿›è¡Œå®Œæ•´æµ‹è¯•

---

## å†å²ä¿®å¤è®°å½•

### ç¬¬7è½®ä¿®å¤ - ç”¨æˆ·æ¨¡å‹é…ç½®API Swaggeræ–‡æ¡£æ·»åŠ  (2024-12-19)
- åˆ›å»ºå®Œæ•´çš„æ¨¡å‹é…ç½®RESTful APIç«¯ç‚¹
- æ·»åŠ æ‰€æœ‰ç›¸å…³çš„OpenAPIæ–‡æ¡£æ³¨è§£
- é›†æˆåˆ°webserverè·¯ç”±ç³»ç»Ÿ
- åˆ›å»ºæµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½

### ç¬¬6è½®ä¿®å¤ - SwaggeråŸºç¡€æ–‡æ¡£ä¿®å¤ (2024-12-19)
- ä¿®å¤OpenAPIæ–‡æ¡£ç”Ÿæˆé—®é¢˜
- æ·»åŠ åŸºæœ¬çš„APIæ–‡æ¡£æ”¯æŒ
- è§£å†³è·¯ç”±å†²çªé—®é¢˜

### ç¬¬5è½®ä¿®å¤ - è·¯ç”±å†²çªè§£å†³ (2024-12-19)
- è§£å†³/v1/completionså’Œ/v1/chat/completionsè·¯ç”±å†²çª
- åˆ›å»ºEEç‰ˆæœ¬çš„APIç«¯ç‚¹

### ç¬¬1-4è½®ä¿®å¤ - ç¼–è¯‘é”™è¯¯è§£å†³ (2024-12-19)
- ä¿®å¤å„ç§Rustç¼–è¯‘é”™è¯¯
- è§£å†³ä¾èµ–å’Œç±»å‹é—®é¢˜
- å»ºç«‹åŸºç¡€é¡¹ç›®ç»“æ„

### ç¬¬9è½®ä¿®å¤ - æœåŠ¡å¯åŠ¨ç¼–è¯‘é”™è¯¯ä¿®å¤ (2024-12-19)
- ä¿®å¤ DbEnum trait å¯¼å…¥é—®é¢˜
- ä¿®å¤ chrono::DateTime ä¸ utoipa å…¼å®¹æ€§é—®é¢˜
- å®Œå–„ OpenAPI æ³¨è§£

---

## æ€»ä½“çŠ¶æ€: âœ… ç¬¬9è½®ä¿®å¤å®Œæˆï¼Œç­‰å¾…ç”¨æˆ·éªŒè¯

æ‰€æœ‰9è½®ä¿®å¤å·²å®Œæˆï¼š
1. **ç¬¬1-4è½®**: ç¼–è¯‘é”™è¯¯ä¿®å¤ âœ…
2. **ç¬¬5è½®**: è·¯ç”±å†²çªä¿®å¤ âœ…
3. **ç¬¬6è½®**: SwaggeråŸºç¡€æ–‡æ¡£ä¿®å¤ âœ…
4. **ç¬¬7è½®**: ç”¨æˆ·æ¨¡å‹é…ç½®APIå®Œæ•´å®ç° âœ…
5. **ç¬¬8è½®**: æœåŠ¡å¯åŠ¨å’ŒAPIå¯è§æ€§ä¿®å¤ âœ…
6. **ç¬¬9è½®**: ç¼–è¯‘é”™è¯¯æœ€ç»ˆä¿®å¤ âœ…

ç”¨æˆ·ç°åœ¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯ä¿®å¤æ•ˆæœï¼š
1. `cargo check --features ee --bin tabby` (éªŒè¯ç¼–è¯‘)
2. `./restart_with_ee_features.sh` (é‡å¯æœåŠ¡)
3. `./test_model_configuration_api.sh` (æµ‹è¯•API)
4. è®¿é—® `http://localhost:8080/swagger-ui` (æŸ¥çœ‹æ–‡æ¡£)